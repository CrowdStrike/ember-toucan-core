{{!
  Regarding Conditionals

  This looks really messy, but Form::Fields::Multiselect exposes named blocks; HOWEVER,
  we cannot conditionally render named blocks due to https://github.com/emberjs/rfcs/issues/735.

  We *can* conditionally render components though, based on the blocks and argument combinations
  users provide us.  This is very brittle, but until https://github.com/emberjs/rfcs/issues/735
  is resolved and a solution is found, this appears to be the only way to truly expose
  conditional named blocks.

  ---

  Regarding glint-expect-error

  "@onChange" of the component expects a an array typed value, but field.setValue is generic,
  accepting anything that DATA[KEY] could be. Similar case with "@selected", but there casting is easy.
}}
<@form.Field @name={{@name}} as |field|>
  {{#if (this.hasOnlyLabelBlock (has-block 'label') (has-block 'hint'))}}
    <Form::Fields::Multiselect
      @contentClass={{@contentClass}}
      @error={{this.mapErrors field.rawErrors}}
      @hint={{@hint}}
      @isDisabled={{@isDisabled}}
      @isReadOnly={{@isReadOnly}}
      @label={{@label}}
      {{! @glint-expect-error }}
      @onChange={{field.setValue}}
      @onFilter={{@onFilter}}
      @options={{@options}}
      @rootTestSelector={{@rootTestSelector}}
      @selected={{this.assertSelected field.value}}
      name={{@name}}
      ...attributes
    >
      <:label>{{yield to='label'}}</:label>

      <:noResults>{{yield to='noResults'}}</:noResults>

      <:chip as |chip|>
        {{yield
          (hash
            index=chip.index
            option=chip.option
            Chip=(component (ensure-safe-component chip.Chip))
            Remove=(component (ensure-safe-component chip.Remove))
          )
          to='chip'
        }}
      </:chip>

      <:default as |multiselect|>
        {{yield
          (hash
            Option=(component (ensure-safe-component multiselect.Option))
            option=multiselect.option
          )
        }}
      </:default>
    </Form::Fields::Multiselect>
  {{else if (this.hasHintAndLabelBlocks (has-block 'label') (has-block 'hint'))
  }}
    <Form::Fields::Multiselect
      @contentClass={{@contentClass}}
      @error={{this.mapErrors field.rawErrors}}
      @hint={{@hint}}
      @isDisabled={{@isDisabled}}
      @isReadOnly={{@isReadOnly}}
      @label={{@label}}
      {{! @glint-expect-error }}
      @onChange={{field.setValue}}
      @onFilter={{@onFilter}}
      @options={{@options}}
      @rootTestSelector={{@rootTestSelector}}
      @selected={{this.assertSelected field.value}}
      name={{@name}}
      ...attributes
    >
      <:label>{{yield to='label'}}</:label>
      <:hint>{{yield to='hint'}}</:hint>

      <:noResults>{{yield to='noResults'}}</:noResults>

      <:chip as |chip|>
        {{yield
          (hash
            index=chip.index
            option=chip.option
            Chip=(component (ensure-safe-component chip.Chip))
            Remove=(component (ensure-safe-component chip.Remove))
          )
          to='chip'
        }}
      </:chip>

      <:default as |multiselect|>
        {{yield
          (hash
            Option=(component (ensure-safe-component multiselect.Option))
            option=multiselect.option
          )
        }}
      </:default>
    </Form::Fields::Multiselect>
  {{else if (this.hasLabelArgAndHintBlock @label (has-block 'hint'))}}
    <Form::Fields::Multiselect
      @contentClass={{@contentClass}}
      @error={{this.mapErrors field.rawErrors}}
      @hint={{@hint}}
      @isDisabled={{@isDisabled}}
      @isReadOnly={{@isReadOnly}}
      @label={{@label}}
      {{! @glint-expect-error }}
      @onChange={{field.setValue}}
      @onFilter={{@onFilter}}
      @options={{@options}}
      @rootTestSelector={{@rootTestSelector}}
      @selected={{this.assertSelected field.value}}
      name={{@name}}
      ...attributes
    >
      <:hint>{{yield to='hint'}}</:hint>

      <:noResults>{{yield to='noResults'}}</:noResults>

      <:chip as |chip|>
        {{yield
          (hash
            index=chip.index
            option=chip.option
            Chip=(component (ensure-safe-component chip.Chip))
            Remove=(component (ensure-safe-component chip.Remove))
          )
          to='chip'
        }}
      </:chip>

      <:default as |multiselect|>
        {{yield
          (hash
            Option=(component (ensure-safe-component multiselect.Option))
            option=multiselect.option
          )
        }}
      </:default>
    </Form::Fields::Multiselect>
  {{else}}
    {{! Argument-only case }}
    <Form::Fields::Multiselect
      @contentClass={{@contentClass}}
      @error={{this.mapErrors field.rawErrors}}
      @hint={{@hint}}
      @isDisabled={{@isDisabled}}
      @isReadOnly={{@isReadOnly}}
      @label={{@label}}
      {{! @glint-expect-error }}
      @onChange={{field.setValue}}
      @onFilter={{@onFilter}}
      @options={{@options}}
      @rootTestSelector={{@rootTestSelector}}
      @selected={{this.assertSelected field.value}}
      name={{@name}}
      ...attributes
    >
      <:noResults>{{yield to='noResults'}}</:noResults>

      <:chip as |chip|>
        {{yield
          (hash
            index=chip.index
            option=chip.option
            Chip=(component (ensure-safe-component chip.Chip))
            Remove=(component (ensure-safe-component chip.Remove))
          )
          to='chip'
        }}
      </:chip>

      <:default as |multiselect|>
        {{yield
          (hash
            Option=(component (ensure-safe-component multiselect.Option))
            option=multiselect.option
          )
        }}
      </:default>
    </Form::Fields::Multiselect>
  {{/if}}
</@form.Field>